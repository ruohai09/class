<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç­çº§æœ‹å‹åœˆ Â· æˆ‘å®¶å¹¸ç¦å¹´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: #f0f2f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px 0 30px 0;
        }

        /* æ•´ä½“å®¹å™¨ â€” ç§»åŠ¨ç«¯å¡ç‰‡é£æ ¼ */
        .container {
            max-width: 500px;
            width: 100%;
            background: white;
            border-radius: 30px 30px 0 0;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.03);
            overflow: hidden;
            padding: 0 16px 20px 16px;
            margin-top: 8px;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  (æ¨¡æ‹Ÿæœ‹å‹åœˆæ ‡é¢˜) */
        .header {
            padding: 18px 0 10px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #f0f0f0;
            background: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .header h1 {
            font-size: 22px;
            font-weight: 620;
            background: linear-gradient(145deg, #cc4e3c, #e68a3d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
        }

        .header span {
            background: #f8f8f8;
            padding: 6px 14px;
            border-radius: 40px;
            font-size: 13px;
            color: #7b7f83;
            font-weight: 500;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.03);
        }

        /* å‘å¸ƒæ¡† â€” æ°¸è¿œåœ¨æœ€ä¸Šé¢ */
        .publish-card {
            background: #ffffff;
            border-radius: 24px;
            padding: 16px 14px;
            margin: 20px 0 18px 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.03), 0 0 0 1px rgba(0,0,0,0.02);
            border: 1px solid #fff;
        }

        .publish-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .avatar {
            width: 42px;
            height: 42px;
            background: #fdeae7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            color: #d2695a;
            border: 2px solid #fee3da;
            flex-shrink: 0;
        }

        .publish-input {
            flex: 1;
            background: #f8fafc;
            border: 1px solid #e6e9ec;
            border-radius: 30px;
            padding: 12px 18px;
            font-size: 15px;
            color: #1e1e1e;
            outline: none;
            transition: 0.15s;
        }

        .publish-input:focus {
            border-color: #f1a37a;
            background: #fff;
            box-shadow: 0 0 0 3px rgba(241, 163, 122, 0.12);
        }

        .publish-input::placeholder {
            color: #a7a9ac;
            font-weight: 400;
        }

        /* å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .upload-label {
            background: #f2f4f6;
            border-radius: 40px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            color: #4c4f54;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: 0.15s;
            border: 1px solid transparent;
        }

        .upload-label:hover {
            background: #e9ecef;
            border-color: #dadde1;
        }

        .upload-label i {
            font-size: 18px;
            color: #e27c5c;
        }

        #image-preview {
            max-height: 60px;
            max-width: 80px;
            border-radius: 16px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            border: 1px solid #eef1f4;
            object-fit: cover;
        }

        .publish-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 12px;
        }

        .publish-btn {
            background: #e7794b;
            border: none;
            padding: 12px 32px;
            border-radius: 44px;
            color: white;
            font-size: 16px;
            font-weight: 590;
            letter-spacing: 0.5px;
            box-shadow: 0 6px 14px rgba(231, 121, 75, 0.25);
            cursor: pointer;
            transition: 0.2s;
            width: fit-content;
            border: 1px solid #d56739;
        }

        .publish-btn:active {
            transform: scale(0.96);
            background: #d56739;
            box-shadow: 0 2px 6px rgba(213, 103, 57, 0.4);
        }

        /* æœ‹å‹åœˆ feed æµ */
        .feed {
            display: flex;
            flex-direction: column;
            gap: 22px;
            margin-top: 8px;
        }

        /* å•æ¡æœ‹å‹åœˆå¡ç‰‡ */
        .post-card {
            background: #ffffff;
            border-radius: 28px;
            padding: 18px 16px 14px 16px;
            box-shadow: 0 2px 14px rgba(0, 0, 0, 0.02), 0 0 0 1px #f2f4f8;
            transition: 0.15s;
            border: 1px solid #fff;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .post-avatar {
            width: 42px;
            height: 42px;
            background: #e2eafc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 19px;
            font-weight: 600;
            color: #43628b;
            border: 2px solid #d4e0f0;
            text-transform: uppercase;
        }

        .post-user {
            font-weight: 650;
            font-size: 16px;
            color: #1c1e22;
        }

        .post-time {
            font-size: 12px;
            color: #93989f;
            margin-top: 2px;
        }

        .post-content {
            font-size: 16px;
            line-height: 1.45;
            color: #24282e;
            margin: 10px 0 12px 12px;
            word-break: break-word;
            white-space: pre-wrap;
        }

        /* æœ‹å‹åœˆå›¾ç‰‡ */
        .post-image {
            width: 100%;
            max-height: 360px;
            object-fit: cover;
            border-radius: 24px;
            background: #f7f9fb;
            margin: 8px 0 12px 0;
            border: 1px solid #edf1f5;
            box-shadow: 0 5px 15px rgba(0,0,0,0.02);
        }

        /* äº’åŠ¨æ  (ç‚¹èµ+è¯„è®º) */
        .interaction-bar {
            display: flex;
            align-items: center;
            justify-content: space-around;
            margin-top: 14px;
            padding-top: 10px;
            border-top: 1px solid #eceef2;
        }

        .action-btn {
            background: transparent;
            border: none;
            padding: 8px 16px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
            font-weight: 520;
            color: #5d6167;
            cursor: pointer;
            transition: 0.12s;
            flex: 1;
            justify-content: center;
        }

        .action-btn.liked {
            color: #e65f3b;
            font-weight: 580;
        }

        .action-btn.liked i {
            color: #e65f3b;
        }

        .action-btn i {
            font-size: 20px;
            color: #7f858d;
        }

        .action-btn:active {
            background: #f2f4f6;
        }

        .like-count, .comment-count {
            font-size: 14px;
            margin-left: 2px;
        }

        /* è¯„è®ºåŒº */
        .comments-section {
            margin-top: 15px;
            background: #f8fafd;
            border-radius: 20px;
            padding: 12px 14px;
            display: none;
        }

        .comments-section.show {
            display: block;
        }

        .comment-item {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .comment-avatar {
            width: 28px;
            height: 28px;
            background: #d8e2ef;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: #3e5670;
            text-transform: uppercase;
        }

        .comment-content {
            background: white;
            padding: 8px 14px;
            border-radius: 20px;
            flex: 1;
            word-break: break-word;
            border: 1px solid #eef1f6;
            color: #22262b;
        }

        .comment-name {
            font-weight: 650;
            font-size: 13px;
            margin-bottom: 2px;
            color: #2e3c4f;
        }

        .comment-text {
            font-size: 14px;
            line-height: 1.4;
        }

        .add-comment {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
        }

        .comment-input {
            flex: 1;
            background: white;
            border: 1px solid #dce1e8;
            border-radius: 30px;
            padding: 10px 16px;
            font-size: 14px;
            outline: none;
        }

        .comment-input:focus {
            border-color: #e8845c;
        }

        .comment-submit {
            background: #e8845c;
            border: none;
            color: white;
            padding: 10px 18px;
            border-radius: 40px;
            font-size: 13px;
            font-weight: 550;
            cursor: pointer;
        }

        .empty-feed {
            text-align: center;
            padding: 40px 20px;
            color: #8f969e;
            background: #f9fbfd;
            border-radius: 32px;
            font-size: 16px;
            margin: 30px 0;
            border: 1px dashed #d0d7de;
        }

        /* ä¸€äº›emoji/iconæ¨¡æ‹Ÿ (å› ä¸ºçº¯htmlä¸èƒ½ç”¨iconåº“ï¼Œå°±ç”¨unicodeç¬¦å·) */
        .icon {
            font-size: 20px;
            line-height: 1;
        }

        .footer-note {
            font-size: 12px;
            color: #b0b6be;
            text-align: center;
            margin: 25px 0 10px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ“¸ ç­çº§æœ‹å‹åœˆ Â· å¹´å‘³æ‘„å½±å±•</h1>
        <span>ğŸ‰ æˆ‘å®¶å¹¸ç¦å¹´</span>
    </div>

    <!-- å‘å¸ƒå™¨ -->
    <div class="publish-card">
        <div class="publish-header">
            <div class="avatar" id="currentUserAvatar">ğŸ‘¤</div>
            <input type="text" class="publish-input" id="postContentInput" placeholder="å†™ä¸€å¥æ–°å¹´ç¥ç¦æˆ–ç…§ç‰‡æ•…äº‹...">
        </div>

        <div class="upload-area">
            <label for="imageUpload" class="upload-label">
                <span class="icon">ğŸ“</span> ä¸Šä¼ è¿‡å¹´ç…§ç‰‡
            </label>
            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
            <img id="image-preview" src="#" alt="é¢„è§ˆ" style="display: none;">
        </div>

        <div class="publish-actions">
            <button class="publish-btn" id="publishPostBtn">â• å‘ å¸ƒ æœ‹ å‹ åœˆ</button>
        </div>
    </div>

    <!-- æœ‹å‹åœˆåŠ¨æ€æµ -->
    <div class="feed" id="feedContainer">
        <!-- åŠ¨æ€ä¼šé€šè¿‡jsåŠ¨æ€æ¸²æŸ“ -->
    </div>
    <div class="footer-note">â€”â€” é•¿æŒ‰ç‚¹èµï¼Œåˆ†äº«å¹´å‘³ â€”â€”</div>
</div>

<script>
    (function() {
        // ---------- æ•°æ®å­˜å‚¨ ----------
        const STORAGE_KEY = 'class_friends_circle';

        // é»˜è®¤åˆå§‹æ•°æ® (ä¸¤æ¡ç¤ºä¾‹å†…å®¹ï¼Œå¯é€‰ï¼Œä¹Ÿå¯ä»¥ä¸ºç©º)
        const defaultPosts = [
            {
                id: 'post1',
                userName: 'å°æ‘„å½±å¸ˆ',
                userAvatar: 'ğŸ“·',
                content: 'ä»Šå¹´çš„å¹´å¤œé¥­æˆ‘æ‹äº†åˆæ‹ï¼ŒåŠ ä¸Šæš–è‰²æ»¤é•œï¼Œå¹´å‘³è¶³è¶³çš„ï¼',
                image: 'https://images.unsplash.com/photo-1545468800-8cdca8e9d9f8?w=600&auto=format', // ç¤ºä¾‹å¹´å¤œé¥­å›¾ç‰‡(unsplash)
                timestamp: Date.now() - 86400000, // æ˜¨å¤©
                likes: 8,
                likedByCurrent: false,
                comments: [
                    { userName: 'æè€å¸ˆ', avatar: 'ğŸ‘©â€ğŸ«', text: 'çœ‹å¾—æˆ‘éƒ½é¥¿äº†ğŸ˜‹' },
                    { userName: 'å°èŒ', avatar: 'ğŸ£', text: 'æ»¤é•œé€‰å¾—çœŸå¥½ï¼' }
                ]
            },
            {
                id: 'post2',
                userName: 'çˆ±ç¬‘çš„å…¨å®¶',
                userAvatar: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§',
                content: 'ç¬¬ä¸€æ¬¡è‡ªå·±ç»™å…¨å®¶ç¦åŠ äº†â€œä¸“å±æ°´å°â€â¤ï¸Yï¼Œä¿æŠ¤ç‰ˆæƒï½è¿˜è°ƒäº®äº†æš—éƒ¨ã€‚',
                image: 'https://images.unsplash.com/photo-1601306186259-a0c4e43d8598?w=600&auto=format', // å®¶åº­æ¸©é¦¨å›¾ç‰‡
                timestamp: Date.now() - 172800000,
                likes: 15,
                likedByCurrent: false,
                comments: [
                    { userName: 'å°æ˜', avatar: 'ğŸ˜', text: 'æ°´å°è®¾è®¡å¾—ä¸é”™ï¼' }
                ]
            }
        ];

        // å°è¯•è¯»å–æœ¬åœ°å­˜å‚¨
        let posts = [];
        try {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                posts = JSON.parse(stored);
                // ç¡®ä¿æ¯ä¸ªpostæœ‰commentsæ•°ç»„ã€likedByCurrentå­—æ®µ (å¯èƒ½è€æ•°æ®æ²¡æœ‰)
                posts = posts.map(p => ({
                    ...p,
                    likedByCurrent: p.likedByCurrent || false,
                    comments: p.comments || []
                }));
            } else {
                posts = defaultPosts;
            }
        } catch (e) {
            console.warn('è¯»å–å­˜å‚¨å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®', e);
            posts = defaultPosts;
        }

        // ä¿å­˜è‡³localStorage
        function savePosts() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));
        }

        // è¾…åŠ©å‡½æ•°ï¼šè·å–å½“å‰ç”¨æˆ· (ç®€åŒ–ä¸ºä¸€ä¸ªç­çº§æ˜µç§°ï¼Œæ¯æ¬¡ä¼šè¯å›ºå®šä½†ä¸åŒè®¾å¤‡å¯ä¸åŒ)
        function getCurrentUser() {
            // ç®€å•ç”¨sessionå­˜å‚¨ç”¨æˆ·åï¼Œè‹¥æ— åˆ™éšæœºä¸€ä¸ª
            let user = sessionStorage.getItem('circle_username');
            let avatar = sessionStorage.getItem('circle_useravatar');
            if (!user) {
                const names = ['å°å°ä¿¡æ¯å‘˜', 'æ‘„å½±å°å’–', 'å¹´å‘³æ•æ‰å‘˜', 'å…‰å½±å°‘å¹´', 'ä¿®å›¾å°èƒ½æ‰‹', 'æ–°å¹´å¿«ä¹'];
                const avatars = ['ğŸ£', 'ğŸ“¸', 'ğŸ¨', 'ğŸ§§', 'ğŸ²', 'âœ¨'];
                const idx = Math.floor(Math.random() * names.length);
                user = names[idx];
                avatar = avatars[idx];
                sessionStorage.setItem('circle_username', user);
                sessionStorage.setItem('circle_useravatar', avatar);
            }
            return { name: user, avatar: avatar };
        }

        const currentUser = getCurrentUser();
        document.getElementById('currentUserAvatar').textContent = currentUser.avatar;

        // DOMå…ƒç´ 
        const feedContainer = document.getElementById('feedContainer');
        const contentInput = document.getElementById('postContentInput');
        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('image-preview');
        const publishBtn = document.getElementById('publishPostBtn');

        // ä¸´æ—¶å­˜å‚¨ä¸Šä¼ çš„å›¾ç‰‡base64 (æœ¬æ¬¡ä¸Šä¼ )
        let uploadedImageBase64 = null;

        // å›¾ç‰‡é¢„è§ˆ
        imageUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) {
                imagePreview.style.display = 'none';
                uploadedImageBase64 = null;
                return;
            }
            const reader = new FileReader();
            reader.onload = function(ev) {
                uploadedImageBase64 = ev.target.result;
                imagePreview.src = ev.target.result;
                imagePreview.style.display = 'block';
                imagePreview.style.maxWidth = '100%';
            };
            reader.readAsDataURL(file);
        });

        // æ¸²æŸ“æ‰€æœ‰æœ‹å‹åœˆ
        function renderFeed() {
            if (!posts || posts.length === 0) {
                feedContainer.innerHTML = `<div class="empty-feed">ğŸ“­ è¿˜æ²¡æœ‰äººå‘æœ‹å‹åœˆï¼Œå¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡ã€Œæˆ‘å®¶å¹¸ç¦å¹´ã€å§âœ¨</div>`;
                return;
            }

            // æŒ‰æ—¶é—´å€’åºæ’åˆ— (æœ€æ–°çš„åœ¨ä¸Šé¢)
            const sorted = [...posts].sort((a,b) => b.timestamp - a.timestamp);

            let htmlStr = '';
            sorted.forEach(post => {
                // å¤„ç†æ—¶é—´æ˜¾ç¤º
                const date = new Date(post.timestamp);
                const timeStr = `${date.getMonth()+1}æœˆ${date.getDate()}æ—¥ ${date.getHours().toString().padStart(2,'0')}:${date.getMinutes().toString().padStart(2,'0')}`;

                // å›¾ç‰‡åŒºåŸŸ
                const imageHtml = post.image ? `<img src="${post.image}" class="post-image" alt="æœ‹å‹åœˆå›¾ç‰‡" onerror="this.style.display='none'">` : '';

                // ç‚¹èµæŒ‰é’®æ ·å¼
                const likeBtnClass = post.likedByCurrent ? 'action-btn liked' : 'action-btn';

                // è¯„è®ºåŒºåŸŸhtml
                let commentsHtml = '';
                if (post.comments && post.comments.length > 0) {
                    post.comments.forEach(cmt => {
                        commentsHtml += `
                            <div class="comment-item">
                                <div class="comment-avatar">${cmt.avatar || 'ğŸ’¬'}</div>
                                <div class="comment-content">
                                    <div class="comment-name">${cmt.userName || 'åŒå­¦'}</div>
                                    <div class="comment-text">${escapeHtml(cmt.text)}</div>
                                </div>
                            </div>
                        `;
                    });
                }

                // è¯„è®ºè¾“å…¥æ¡†ç”¨post-idæ ‡è®°
                const commentsSectionId = `comments-${post.id}`;

                htmlStr += `
                    <div class="post-card" data-post-id="${post.id}">
                        <div class="post-header">
                            <div class="post-avatar">${post.userAvatar || 'ğŸ“·'}</div>
                            <div>
                                <div class="post-user">${escapeHtml(post.userName || 'åŒå­¦')}</div>
                                <div class="post-time">${timeStr}</div>
                            </div>
                        </div>
                        <div class="post-content">${escapeHtml(post.content)}</div>
                        ${imageHtml}
                        <div class="interaction-bar">
                            <button class="${likeBtnClass}" data-action="like" data-post-id="${post.id}">
                                <span class="icon">â¤ï¸</span>
                                <span class="like-count" data-like-id="${post.id}">${post.likes || 0}</span>
                            </button>
                            <button class="action-btn" data-action="toggleComment" data-post-id="${post.id}">
                                <span class="icon">ğŸ’¬</span>
                                <span class="comment-count">${post.comments?.length || 0}</span>
                            </button>
                        </div>
                        <div class="comments-section" id="${commentsSectionId}">
                            ${commentsHtml}
                            <div class="add-comment">
                                <div class="comment-avatar">${currentUser.avatar}</div>
                                <input type="text" class="comment-input" placeholder="è¯´ä¸€å¥ç¥ç¦æˆ–è¯„ä»·..." data-comment-input="${post.id}">
                                <button class="comment-submit" data-submit-comment="${post.id}">å‘é€</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            feedContainer.innerHTML = htmlStr;

            // ç»™æ‰€æœ‰ç‚¹èµæŒ‰é’®ç»‘å®šäº‹ä»¶
            document.querySelectorAll('[data-action="like"]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const postId = btn.dataset.postId;
                    handleLike(postId);
                });
            });

            // åˆ‡æ¢è¯„è®ºæ˜¾ç¤º
            document.querySelectorAll('[data-action="toggleComment"]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const postId = btn.dataset.postId;
                    const commentsSec = document.getElementById(`comments-${postId}`);
                    if (commentsSec) {
                        commentsSec.classList.toggle('show');
                    }
                });
            });

            // è¯„è®ºæäº¤æŒ‰é’®
            document.querySelectorAll('[data-submit-comment]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const postId = btn.dataset.submitComment;
                    const input = document.querySelector(`[data-comment-input="${postId}"]`);
                    if (!input) return;
                    const text = input.value.trim();
                    if (text) {
                        addComment(postId, text);
                        input.value = '';
                    }
                });
            });

            // è¯„è®ºè¾“å…¥æ¡†æ”¯æŒå›è½¦å‘é€
            document.querySelectorAll('[data-comment-input]').forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const postId = input.dataset.commentInput;
                        const text = input.value.trim();
                        if (text) {
                            addComment(postId, text);
                            input.value = '';
                        }
                    }
                });
            });
        }

        // ç®€å•çš„é˜²XSS
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // å¤„ç†ç‚¹èµ
        function handleLike(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            if (post.likedByCurrent) {
                post.likes = Math.max(0, (post.likes || 0) - 1);
                post.likedByCurrent = false;
            } else {
                post.likes = (post.likes || 0) + 1;
                post.likedByCurrent = true;
            }

            savePosts();
            renderFeed(); // ç®€å•åˆ·æ–°
        }

        // æ·»åŠ è¯„è®º
        function addComment(postId, text) {
            const post = posts.find(p => p.id === postId);
            if (!post || !text.trim()) return;

            if (!post.comments) post.comments = [];
            post.comments.push({
                userName: currentUser.name,
                avatar: currentUser.avatar,
                text: text.substring(0, 120)  // é™åˆ¶é•¿åº¦
            });

            savePosts();
            renderFeed();

            // è‡ªåŠ¨å±•å¼€è¯„è®º
            setTimeout(() => {
                const sec = document.getElementById(`comments-${postId}`);
                if (sec) sec.classList.add('show');
            }, 50);
        }

        // å‘å¸ƒæ–°æœ‹å‹åœˆ
        function publishPost() {
            const content = contentInput.value.trim();
            if (!content && !uploadedImageBase64) {
                alert('å†™ç‚¹ä»€ä¹ˆæˆ–ä¸Šä¼ ä¸€å¼ ç…§ç‰‡å§ï½');
                return;
            }

            const newPost = {
                id: 'post_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
                userName: currentUser.name,
                userAvatar: currentUser.avatar,
                content: content || 'åˆ†äº«æˆ‘çš„è¿‡å¹´ç…§ç‰‡ğŸ“·',
                image: uploadedImageBase64 || null,  // å¦‚æœæ²¡æœ‰å›¾ç‰‡ï¼Œå¯ç©º
                timestamp: Date.now(),
                likes: 0,
                likedByCurrent: false,
                comments: []
            };

            posts.push(newPost);
            savePosts();

            // æ¸…ç©ºè¾“å…¥
            contentInput.value = '';
            imageUpload.value = '';
            imagePreview.style.display = 'none';
            imagePreview.src = '#';
            uploadedImageBase64 = null;

            renderFeed();
        }

        publishBtn.addEventListener('click', publishPost);

        // åˆå§‹æ¸²æŸ“
        renderFeed();

        // å¯é€‰ï¼šæ¨¡æ‹Ÿå®šæœŸæ£€æŸ¥æ›´æ–°(ä¸ºäº†åŒä¸€ä¸ªé“¾æ¥ä¸‹çœ‹åˆ°åˆ«äººå‘å¸ƒçš„å†…å®¹ï¼Œéœ€æ‰‹åŠ¨åˆ·æ–°é¡µé¢)
        // ç®€å•æ–¹æ¡ˆï¼šæ¯10ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®ï¼ˆä»…é‡æ–°ä»localStorageè¯»å–ï¼‰â€”â€”ä½†éœ€ä¿ç•™ç‚¹èµçŠ¶æ€ç­‰
        setInterval(() => {
            // é‡æ–°æ‹‰å–localstorage å¹¶åˆå¹¶æœ¬åœ°likeçŠ¶æ€(å¯èƒ½ä¸¢å¤±ï¼Œä½†ä¸ºäº†çœ‹åˆ°æ–°å†…å®¹ï¼Œå¯è¡Œ)
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    const freshPosts = JSON.parse(stored);
                    // åˆå¹¶å½“å‰å†…å­˜ä¸­çš„ likedByCurrent çŠ¶æ€ (é¿å…ç‚¹èµçŠ¶æ€è¢«è¦†ç›–)
                    // ç®€æ˜“å¤„ç†ï¼šç›´æ¥ç”¨æ–°æ•°æ®ä½†ä¿ç•™å½“å‰ç”¨æˆ·çš„ç‚¹èµæ ‡è®° (ä½†å¯èƒ½ä¼šä¸¢)
                    // æ›´å¥½çš„åšæ³•ï¼šç”¨æ–°æ•°æ®å¹¶æ¸²æŸ“ï¼Œä½†æœ€å¥½ä¿ç•™likeæ ‡è®°ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆå¹¶ç­–ç•¥
                    if (freshPosts && Array.isArray(freshPosts)) {
                        // ä¿ç•™å½“å‰useråœ¨æ¯ä¸ªpostä¸Šçš„ç‚¹èµæ ‡è®°ï¼ˆé€šè¿‡idåŒ¹é…ï¼‰
                        const oldPosts = posts;
                        const merged = freshPosts.map(fp => {
                            const old = oldPosts.find(o => o.id === fp.id);
                            if (old) {
                                return {
                                    ...fp,
                                    likedByCurrent: old.likedByCurrent // ä¿ç•™å½“å‰ç‚¹èµçŠ¶æ€
                                };
                            }
                            return {...fp, likedByCurrent: false};
                        });
                        posts = merged;
                        savePosts(); // å°†åˆå¹¶åçš„å­˜å›ï¼ˆæ³¨æ„è¿™ä¼šè¦†ç›–åˆ«äººåˆšå‘çš„è¯„è®º? ä¸å¤ªå®‰å…¨ï¼Œä½†ä¸ºäº†demoï¼‰
                        // æ›´å®‰å…¨ï¼šä»…æ›´æ–°æ¸²æŸ“ï¼Œä¸è¦†ç›–å­˜å‚¨ã€‚ä½†æˆ‘ä»¬ä¸ºäº†æ¼”ç¤ºç®€æ´ã€‚
                        renderFeed();
                    }
                }
            } catch (e) {}
        }, 8000); // æ¯8ç§’æ£€æŸ¥ä¸€æ¬¡â€œæ–°å†…å®¹â€

    })();
</script>
</body>
</html>